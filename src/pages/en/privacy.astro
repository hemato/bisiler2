---
// === IMPORTS ===
import Layout from '../../layouts/Layout.astro';
import { getLangFromUrl, getTranslations } from '../../i18n/utils';
import { COMPANY_INFO } from '../../config/company';
import { CONTACT_INFO } from '../../config/contact';
import { DOMAIN_CONFIG, getUrl } from '../../config/domain';
import { getRoute } from '../../utils/routes';

// === UTILITY IMPORTS ===
import { AdvancedSEOManager } from '../../utils/seo-advanced';
import { generateLocalBusinessSchema, generateBreadcrumbSchema, generateWebsiteSchema } from '../../utils/structured-data';
import { initPerformanceOptimizations, CRITICAL_RESOURCES } from '../../utils/performance';
import { securityHeaders, xssProtection, cspUtils } from '../../utils/security';

// === LANGUAGE & URL SETUP ===
const lang = getLangFromUrl(Astro.url);
const t = await getTranslations(lang);
const currentUrl = new URL(Astro.request.url);

// === ENGLISH-SPECIFIC PRIVACY PAGE CONFIGURATION ===
const PRIVACY_PAGE_CONFIG_EN = {
  PERFORMANCE: {
    READING_TIME: 8, // minutes estimated reading time for English
    CONTENT_SECTIONS: 10,
    SCROLL_TRACKING: true,
    PRINT_OPTIMIZATION: true,
    LAZY_LOAD_MARGIN: '50px 0px',
    INTERSECTION_THRESHOLD: 0.2
  },
  SEO: {
    TITLE: `Privacy Policy - ${COMPANY_INFO.name} | GDPR Compliant Data Protection`,
    DESCRIPTION: `${COMPANY_INFO.name} privacy policy and GDPR compliant personal data protection. Detailed information about data collection, processing, storage and your rights.`,
    KEYWORDS: ["privacy policy", "GDPR", "data protection", "personal data", "cookie policy", "KVKK", "data rights"],
    CANONICAL: "/en/privacy",
    LEGAL_TYPE: "PrivacyPolicy",
    LANGUAGE: "en-US"
  },
  CONTENT: {
    LAST_UPDATED: "2024-01-15",
    VERSION: "2.1",
    COMPLIANCE_STANDARDS: ["GDPR", "KVKK", "CCPA"],
    DOCUMENT_TYPE: "legal",
    READING_LEVEL: "professional"
  },
  TRACKING: {
    LEGAL_COMPLIANCE: true,
    READING_ANALYTICS: true,
    PRINT_TRACKING: true,
    ENGAGEMENT_TRACKING: true
  },
  SECURITY: {
    CSP_NONCE: true,
    XSS_PROTECTION: true,
    CONTENT_VALIDATION: true
  }
};

// === HREFLANG & BREADCRUMBS ===
const hreflang = [
  { lang: 'tr', url: `${DOMAIN_CONFIG.baseUrl}/gizlilik-politikasi` },
  { lang: 'en', url: `${DOMAIN_CONFIG.baseUrl}/en/privacy` }
];

const breadcrumbs = [
  { name: 'Home', url: getRoute(lang, 'home') },
  { name: 'Privacy Policy', url: getRoute(lang, 'privacy') }
];

// === SECURITY CONFIGURATION ===
const securityNonce = cspUtils.generateNonce();

// === SEO OPTIMIZATION ===
const seoManager = new AdvancedSEOManager();

const optimizedMeta = {
  description: PRIVACY_PAGE_CONFIG_EN.SEO.DESCRIPTION,
  keywords: PRIVACY_PAGE_CONFIG_EN.SEO.KEYWORDS.join(', ')
};

// === STRUCTURED DATA GENERATION ===
const organizationSchema = generateLocalBusinessSchema(COMPANY_INFO.name);
const breadcrumbSchema = generateBreadcrumbSchema(breadcrumbs);
const webPageSchema = generateWebsiteSchema(COMPANY_INFO.name);

// Enhanced Legal Document schema for English
const legalDocumentSchemaEN = {
  "@context": "https://schema.org",
  "@type": "LegalDocument",
  "name": "Privacy Policy",
  "description": "GDPR and KVKK compliant privacy policy",
  "url": currentUrl.toString(),
  "dateModified": PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED,
  "version": PRIVACY_PAGE_CONFIG_EN.CONTENT.VERSION,
  "inLanguage": PRIVACY_PAGE_CONFIG_EN.SEO.LANGUAGE,
  "author": {
    "@type": "Organization",
    "name": COMPANY_INFO.name
  },
  "publisher": {
    "@type": "Organization",
    "name": COMPANY_INFO.name
  },
  "isBasedOn": PRIVACY_PAGE_CONFIG_EN.CONTENT.COMPLIANCE_STANDARDS,
  "genre": "legal",
  "audience": {
    "@type": "Audience",
    "audienceType": "General Public"
  },
  "keywords": PRIVACY_PAGE_CONFIG_EN.SEO.KEYWORDS,
  "mainEntity": {
    "@type": "Thing",
    "name": "Privacy Rights and Data Protection",
    "description": "Comprehensive privacy policy covering data collection, processing, and user rights"
  }
};

// Generate WebPage Schema using AdvancedSEOManager
const pageSchemas = seoManager.generateSchemasForPage('privacy', {
  page: {
    name: PRIVACY_PAGE_CONFIG_EN.SEO.TITLE,
    description: optimizedMeta.description,
    url: getUrl(getRoute(lang, 'privacy')),
    breadcrumb: breadcrumbs
  },
  baseUrl: DOMAIN_CONFIG.baseUrl
}, lang);

// Combine all schemas
const allSchemas = [
  organizationSchema,
  breadcrumbSchema,
  webPageSchema,
  legalDocumentSchemaEN,
  ...pageSchemas
];

// === PERFORMANCE PRELOADING ===
const criticalResources = CRITICAL_RESOURCES.fonts;
---

<Layout
  title={PRIVACY_PAGE_CONFIG_EN.SEO.TITLE}
  description={optimizedMeta.description}
  structuredData={allSchemas}
  ogImage={`${DOMAIN_CONFIG.baseUrl}/images/privacy-policy-og.jpg`}
  canonical={getUrl(getRoute(lang, 'privacy'))}
  breadcrumbs={breadcrumbs}
>
  <!-- Enhanced SEO Meta Tags -->
  <meta slot="head" name="keywords" content={optimizedMeta.keywords} />
  <meta slot="head" name="robots" content="index, follow" />
  <meta slot="head" name="document-type" content="Legal Document" />
  <meta slot="head" name="document-version" content={PRIVACY_PAGE_CONFIG_EN.CONTENT.VERSION} />
  <meta slot="head" name="last-modified" content={PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED} />
  <meta slot="head" name="compliance" content={PRIVACY_PAGE_CONFIG_EN.CONTENT.COMPLIANCE_STANDARDS.join(', ')} />
  <meta slot="head" name="language" content={PRIVACY_PAGE_CONFIG_EN.SEO.LANGUAGE} />
  
  <!-- OpenGraph Meta Tags -->
  <meta slot="head" property="og:title" content={PRIVACY_PAGE_CONFIG_EN.SEO.TITLE} />
  <meta slot="head" property="og:description" content={optimizedMeta.description} />
  <meta slot="head" property="og:type" content="article" />
  <meta slot="head" property="og:url" content={currentUrl.toString()} />
  <meta slot="head" property="og:image" content={`${DOMAIN_CONFIG.baseUrl}/images/privacy-policy-og.jpg`} />
  <meta slot="head" property="og:locale" content="en_US" />
  <meta slot="head" property="og:site_name" content={COMPANY_INFO.name} />
  <meta slot="head" property="article:published_time" content={PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED} />
  <meta slot="head" property="article:modified_time" content={PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED} />
  <meta slot="head" property="article:section" content="Legal" />
  
  <!-- Twitter Card Meta Tags -->
  <meta slot="head" name="twitter:card" content="summary_large_image" />
  <meta slot="head" name="twitter:title" content={PRIVACY_PAGE_CONFIG_EN.SEO.TITLE} />
  <meta slot="head" name="twitter:description" content={optimizedMeta.description} />
  <meta slot="head" name="twitter:image" content={`${DOMAIN_CONFIG.baseUrl}/images/privacy-policy-twitter.jpg`} />
  <meta slot="head" name="twitter:creator" content="@techcorp_tr" />
  
  <!-- Security Headers -->
  <meta slot="head" http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta slot="head" http-equiv="X-Frame-Options" content="DENY" />
  <meta slot="head" http-equiv="X-XSS-Protection" content="1; mode=block" />

  <!-- Legal Document Header -->
  <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="text-center">
        <div class="inline-flex items-center px-4 py-2 bg-blue-100 rounded-full text-sm font-medium text-blue-800 mb-4">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5C2.056 5.649 2 6.319 2 7c0 5.225 3.34 9.67 8 11.317C14.66 16.67 18 12.225 18 7c0-.682-.057-1.351-.166-2A11.954 11.954 0 0110 1.944zM11 14a1 1 0 11-2 0 1 1 0 012 0zm0-7a1 1 0 10-2 0v3a1 1 0 102 0V7z" clip-rule="evenodd"></path>
          </svg>
          GDPR & KVKK Compliant
        </div>
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Privacy Policy</h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Your data security is our priority. This policy transparently explains our data protection approach and your privacy rights.
        </p>
        <div class="mt-6 flex items-center justify-center space-x-6 text-sm text-gray-500">
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
            </svg>
            {PRIVACY_PAGE_CONFIG_EN.PERFORMANCE.READING_TIME} min read
          </div>
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            Last updated: {new Date(PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED).toLocaleDateString('en-US')}
          </div>
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm8 8v2a1 1 0 01-1 1H6a1 1 0 01-1-1v-2h10z" clip-rule="evenodd"></path>
            </svg>
            Version: {PRIVACY_PAGE_CONFIG_EN.CONTENT.VERSION}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="bg-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Reading Progress Bar -->
      <div class="fixed top-0 left-0 w-full h-1 bg-gray-200 z-50">
        <div id="reading-progress" class="h-full bg-gradient-to-r from-blue-500 to-indigo-600 transition-all duration-300 ease-out" style="width: 0%"></div>
      </div>

      <!-- Privacy Policy Quick Navigation -->
      <div class="bg-gray-50 rounded-lg p-6 mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Navigation</h2>
        <div class="grid md:grid-cols-2 gap-3">
          <a href="#data-controller" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">1</span>
            Data Controller
          </a>
          <a href="#data-collected" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">2</span>
            Data Collected
          </a>
          <a href="#data-purposes" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">3</span>
            Data Collection Purposes
          </a>
          <a href="#data-sharing" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">4</span>
            Data Sharing
          </a>
          <a href="#data-security" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">5</span>
            Data Security
          </a>
          <a href="#your-rights" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:text-blue-600 hover:bg-white rounded transition-colors">
            <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-semibold mr-3">7</span>
            Your Rights
          </a>
        </div>
      </div>

      <div class="prose prose-lg max-w-none">
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-8">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-blue-700">
                This privacy policy has been prepared in accordance with <strong>GDPR (General Data Protection Regulation)</strong> and <strong>KVKK (Personal Data Protection Law)</strong>
                regulations. It explains in detail your rights and our responsibilities regarding the processing of personal data.
              </p>
            </div>
          </div>
        </div>

        <h2 id="data-controller">1. Data Controller</h2>
        <p>
          <strong>Company:</strong> {COMPANY_INFO.legalName}<br>
          <strong>Address:</strong> {CONTACT_INFO.address.full.en}<br>
          <strong>Email:</strong> {CONTACT_INFO.email.privacy}<br>
          <strong>Phone:</strong> {CONTACT_INFO.phone.primary}
        </p>

        <h2 id="data-collected">2. Personal Data Collected</h2>
        <p>The following personal data is collected on our website:</p>
        <ul>
          <li><strong>Contact Information:</strong> Name, surname, email address, phone number</li>
          <li><strong>Company Information:</strong> Company name, position, industry sector</li>
          <li><strong>Service Information:</strong> Requested service type, project details</li>
          <li><strong>Technical Information:</strong> IP address, cookie information, browser information</li>
          <li><strong>Usage Data:</strong> Website navigation patterns, page views, time spent</li>
        </ul>

        <h2 id="data-purposes">3. Data Collection Purposes</h2>
        <p>Your personal data is collected for the following purposes:</p>
        <ul>
          <li>Responding to service requests and inquiries</li>
          <li>Providing quotes and pricing information</li>
          <li>Project management and customer relationship management</li>
          <li>Fulfilling our legal obligations</li>
          <li>Improving website performance and user experience</li>
          <li>Marketing communications (with your consent)</li>
          <li>Security and fraud prevention</li>
        </ul>

        <h2 id="data-sharing">4. Data Sharing</h2>
        <p>
          Your personal data will not be shared with third parties without your explicit consent. 
          The following situations are exceptions:
        </p>
        <ul>
          <li>Legal obligations and regulatory requirements</li>
          <li>Service providers (EmailJS, Google Analytics, etc.)</li>
          <li>Limited sharing with business partners for service delivery</li>
          <li>Corporate transactions (mergers, acquisitions)</li>
          <li>Protection of our rights and safety</li>
        </ul>

        <h2 id="data-security">5. Data Security</h2>
        <p>
          Your personal data is protected with appropriate technical and administrative measures:
        </p>
        <ul>
          <li>SSL/TLS encryption for data transmission</li>
          <li>Secure server infrastructure with regular updates</li>
          <li>Access control and authorization systems</li>
          <li>Regular security audits and vulnerability assessments</li>
          <li>Employee training on data protection</li>
          <li>Incident response and breach notification procedures</li>
        </ul>

        <h2>6. Cookies and Tracking Technologies</h2>
        <p>
          Our website uses cookies to improve user experience and analyze performance:
        </p>
        <ul>
          <li><strong>Essential Cookies:</strong> Necessary for website functionality</li>
          <li><strong>Analytics Cookies:</strong> Google Analytics for performance analysis</li>
          <li><strong>Marketing Cookies:</strong> Advertising campaigns and tracking</li>
          <li><strong>Preference Cookies:</strong> Remember your settings and preferences</li>
        </ul>
        <p>
          You can manage cookie preferences through your browser settings or our cookie consent banner.
        </p>

        <h2 id="your-rights">7. Your Rights Under GDPR and KVKK</h2>
        <p>Under GDPR and KVKK, you have the following rights:</p>
        <ul>
          <li><strong>Right to Information:</strong> Know whether your personal data is being processed</li>
          <li><strong>Right of Access:</strong> Request information about your personal data</li>
          <li><strong>Right to Rectification:</strong> Request correction of your personal data</li>
          <li><strong>Right to Erasure:</strong> Request deletion of your personal data</li>
          <li><strong>Right to Restriction:</strong> Request restriction of processing</li>
          <li><strong>Right to Data Portability:</strong> Receive your data in a structured format</li>
          <li><strong>Right to Object:</strong> Object to processing for marketing purposes</li>
          <li><strong>Right to Withdraw Consent:</strong> Withdraw consent at any time</li>
        </ul>

        <h2>8. Data Retention Period</h2>
        <p>
          Personal data is retained for the period necessary to fulfill the collection purposes, 
          comply with legal obligations, or until you request deletion. Specific retention periods:
        </p>
        <ul>
          <li><strong>Contact inquiries:</strong> 3 years from last contact</li>
          <li><strong>Project data:</strong> 5 years after project completion</li>
          <li><strong>Marketing data:</strong> Until consent is withdrawn</li>
          <li><strong>Legal obligations:</strong> As required by applicable law</li>
        </ul>

        <h2>9. International Data Transfers</h2>
        <p>
          Some of our service providers may be located outside the European Economic Area (EEA). 
          We ensure adequate protection through:
        </p>
        <ul>
          <li>European Commission adequacy decisions</li>
          <li>Standard Contractual Clauses (SCCs)</li>
          <li>Binding Corporate Rules where applicable</li>
          <li>Your explicit consent for specific transfers</li>
        </ul>

        <h2>10. Contact Information</h2>
        <p>
          For questions about our privacy policy or to exercise your rights, please contact us:
        </p>
        <ul>
          <li><strong>Email:</strong> {CONTACT_INFO.email.privacy}</li>
          <li><strong>Phone:</strong> {CONTACT_INFO.phone.primary}</li>
          <li><strong>Post:</strong> {CONTACT_INFO.address.full.en}</li>
        </ul>

        <h2>11. Policy Updates</h2>
        <p>
          This privacy policy may be updated as needed. Significant changes will be announced 
          on our website and, where required, we will seek your renewed consent.
        </p>

        <!-- Enhanced Contact Section -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mt-8">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Data Protection Contact and Requests</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-medium text-gray-900 mb-2">Data Controller Contact</h4>
              <div class="space-y-2 text-sm text-gray-600">
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                  </svg>
                  <a href={`mailto:${CONTACT_INFO.email.privacy}`} class="hover:text-blue-600">
                    {CONTACT_INFO.email.privacy}
                  </a>
                </div>
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                  </svg>
                  <a href={`tel:${CONTACT_INFO.phone.primary}`} class="hover:text-blue-600">
                    {CONTACT_INFO.phone.primary}
                  </a>
                </div>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-gray-900 mb-2">Request Procedures</h4>
              <p class="text-sm text-gray-600 mb-3">
                To exercise your rights under GDPR and KVKK, you can submit your request 
                in writing or electronically using our secure form.
              </p>
              <a href="/en/data-request-form" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm8 8v2a1 1 0 01-1 1H6a1 1 0 01-1-1v-2h10z" clip-rule="evenodd"></path>
                </svg>
                Data Request Form
              </a>
            </div>
          </div>
        </div>

        <!-- Document Information -->
        <div class="bg-gray-50 rounded-lg p-6 mt-8">
          <div class="grid md:grid-cols-3 gap-6 text-center">
            <div>
              <div class="text-2xl font-bold text-blue-600 mb-2">{PRIVACY_PAGE_CONFIG_EN.CONTENT.VERSION}</div>
              <div class="text-sm text-gray-600">Policy Version</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-green-600 mb-2">
                {new Date(PRIVACY_PAGE_CONFIG_EN.CONTENT.LAST_UPDATED).toLocaleDateString('en-US')}
              </div>
              <div class="text-sm text-gray-600">Last Updated</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-purple-600 mb-2">{PRIVACY_PAGE_CONFIG_EN.CONTENT.COMPLIANCE_STANDARDS.length}</div>
              <div class="text-sm text-gray-600">Compliance Standards</div>
            </div>
          </div>
          <div class="mt-4 text-center">
            <p class="text-xs text-gray-500">
              This policy is prepared in compliance with {PRIVACY_PAGE_CONFIG_EN.CONTENT.COMPLIANCE_STANDARDS.join(', ')}
              regulations.
            </p>
          </div>
        </div>

        <!-- Print/Share Actions -->
        <div class="flex justify-center space-x-4 mt-8 no-print">
          <button
            onclick="window.print()"
            class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zM5 14H4v-3h1v3zm2 0v2h6v-2H7z" clip-rule="evenodd"></path>
            </svg>
            Print
          </button>
          <button
            onclick="copyToClipboard()"
            class="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-700 text-sm font-medium rounded-md hover:bg-blue-200 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
              <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path>
            </svg>
            Copy Link
          </button>
        </div>
      </div>
    </div>
  </div>
</Layout>

<!-- Enhanced Privacy Policy JavaScript for English -->
<script is:inline define:vars={{
  readingTime: PRIVACY_PAGE_CONFIG_EN.PERFORMANCE.READING_TIME,
  trackingEnabled: PRIVACY_PAGE_CONFIG_EN.TRACKING.READING_ANALYTICS,
  securityNonce: securityNonce,
  lang: lang
}}>
  // Enhanced reading progress tracking for English privacy policy
  document.addEventListener('DOMContentLoaded', function() {
    
    // === SECURITY FUNCTIONS ===
    function sanitizeInput(input) {
      if (!input || typeof input !== 'string') return '';
      return input
        .replace(/[<>]/g, '')
        .replace(/javascript:/gi, '')
        .replace(/on\w+=/gi, '')
        .trim();
    }
    
    // === PERFORMANCE FUNCTIONS ===
    function addDnsPrefetch(domain) {
      if (document.querySelector('link[href="' + domain + '"]')) return;
      var link = document.createElement('link');
      link.rel = 'dns-prefetch';
      link.href = domain;
      document.head.appendChild(link);
    }
    
    // Performance metrics
    var metrics = {
      lcp: 0,
      cls: 0,
      sectionsViewed: 0,
      timeOnPage: Date.now(),
      readingProgress: 0,
      printActions: 0,
      linkCopies: 0
    };
    
    // Core Web Vitals monitoring
    if (window.PerformanceObserver) {
      try {
        new PerformanceObserver(function(list) {
          var entries = list.getEntries();
          if (entries.length > 0) {
            metrics.lcp = entries[entries.length - 1].startTime;
          }
        }).observe({ entryTypes: ['largest-contentful-paint'] });
        
        var clsValue = 0;
        new PerformanceObserver(function(list) {
          for (var entry of list.getEntries()) {
            if (!entry.hadRecentInput) {
              clsValue += entry.value;
            }
          }
          metrics.cls = clsValue;
        }).observe({ entryTypes: ['layout-shift'] });
      } catch (e) {
        console.warn('Performance observers failed');
      }
    }
    
    // === OPTIMIZATIONS ===
    addDnsPrefetch('//fonts.googleapis.com');
    
    // Reading Progress Tracking
    function updateReadingProgress() {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      
      var progressBar = document.getElementById('reading-progress');
      if (progressBar) {
        progressBar.style.width = scrolled + '%';
      }
      
      metrics.readingProgress = Math.max(metrics.readingProgress, scrolled);
      
      // Track reading milestones for analytics
      if (trackingEnabled && typeof gtag !== 'undefined') {
        if (scrolled >= 25 && !window.privacy_25_tracked) {
          gtag('event', 'privacy_policy_read_25', {
            event_category: 'Legal Document',
            event_label: 'Privacy Policy EN',
            page_language: 'en'
          });
          window.privacy_25_tracked = true;
        }
        
        if (scrolled >= 50 && !window.privacy_50_tracked) {
          gtag('event', 'privacy_policy_read_50', {
            event_category: 'Legal Document',
            event_label: 'Privacy Policy EN',
            page_language: 'en'
          });
          window.privacy_50_tracked = true;
        }
        
        if (scrolled >= 100 && !window.privacy_complete_tracked) {
          gtag('event', 'privacy_policy_complete', {
            event_category: 'Legal Document',
            event_label: 'Privacy Policy EN',
            value: readingTime,
            page_language: 'en'
          });
          window.privacy_complete_tracked = true;
        }
      }
    }

    // Copy URL to clipboard
    function copyToClipboard() {
      navigator.clipboard.writeText(window.location.href).then(function() {
        metrics.linkCopies++;
        
        // Show success feedback
        var button = event.target.closest('button');
        var originalText = button.innerHTML;
        button.innerHTML = '<svg class="w-4 h-4 mr-2 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>Copied!';
        button.className = button.className.replace('text-blue-700', 'text-green-700').replace('bg-blue-100', 'bg-green-100');
        
        setTimeout(function() {
          button.innerHTML = originalText;
          button.className = button.className.replace('text-green-700', 'text-blue-700').replace('bg-green-100', 'bg-blue-100');
        }, 2000);
        
        if (trackingEnabled && typeof gtag !== 'undefined') {
          gtag('event', 'privacy_link_copy', {
            event_category: 'Legal Document',
            page_language: 'en'
          });
        }
      });
    }

    // Enhanced Section Navigation
    function initSectionNavigation() {
      var navLinks = document.querySelectorAll('a[href^="#"]');
      var sections = document.querySelectorAll('h2[id]');
      
      // Smooth scroll for navigation links
      navLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          var targetId = this.getAttribute('href').substring(1);
          var targetSection = document.getElementById(targetId);
          
          if (targetSection) {
            targetSection.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
            
            metrics.sectionsViewed++;
            
            // Track section navigation
            if (trackingEnabled && typeof gtag !== 'undefined') {
              gtag('event', 'privacy_section_view', {
                event_category: 'Legal Document',
                event_label: targetId,
                page_language: 'en'
              });
            }
          }
        });
      });

      // Highlight current section in navigation
      function highlightCurrentSection() {
        var current = '';
        sections.forEach(function(section) {
          var sectionTop = section.offsetTop;
          if (window.scrollY >= sectionTop - 100) {
            current = section.getAttribute('id');
          }
        });

        navLinks.forEach(function(link) {
          link.classList.remove('bg-white', 'text-blue-600');
          if (link.getAttribute('href') === '#' + current) {
            link.classList.add('bg-white', 'text-blue-600');
          }
        });
      }

      window.addEventListener('scroll', highlightCurrentSection);
    }

    // Print Optimization
    function optimizeForPrint() {
      window.addEventListener('beforeprint', function() {
        metrics.printActions++;
        
        // Track print action
        if (trackingEnabled && typeof gtag !== 'undefined') {
          gtag('event', 'privacy_policy_print', {
            event_category: 'Legal Document',
            event_label: 'Privacy Policy EN',
            page_language: 'en'
          });
        }
        
        // Expand all collapsed sections for print
        document.querySelectorAll('.no-print').forEach(function(el) {
          el.style.display = 'none';
        });
      });
      
      window.addEventListener('afterprint', function() {
        // Restore interactive elements
        document.querySelectorAll('.no-print').forEach(function(el) {
          el.style.display = '';
        });
      });
    }

    // Privacy Policy Specific Analytics
    function initPrivacyAnalytics() {
      if (!trackingEnabled) return;
      
      // Track document load
      if (typeof gtag !== 'undefined') {
        gtag('event', 'privacy_policy_load', {
          event_category: 'Legal Document',
          event_label: 'Privacy Policy EN',
          page_language: 'en',
          custom_parameters: {
            document_version: '2.1',
            compliance_standards: 'GDPR, KVKK, CCPA',
            estimated_reading_time: readingTime
          }
        });
      }

      // Track time spent on page
      var startTime = Date.now();
      window.addEventListener('beforeunload', function() {
        var timeSpent = Math.round((Date.now() - startTime) / 1000);
        if (typeof gtag !== 'undefined' && timeSpent > 10) {
          gtag('event', 'privacy_policy_time_spent', {
            event_category: 'Legal Document',
            event_label: 'Privacy Policy EN',
            value: timeSpent,
            page_language: 'en'
          });
        }
      });
    }

    // Initialize all functionality
    updateReadingProgress();
    initSectionNavigation();
    optimizeForPrint();
    initPrivacyAnalytics();
    
    // Scroll event listeners
    window.addEventListener('scroll', updateReadingProgress);
    
    // === ANALYTICS ===
    setTimeout(function() {
      var timeOnPage = Date.now() - metrics.timeOnPage;
      console.log('📊 EN Privacy Page Metrics:', {
        ...metrics,
        timeOnPage: Math.round(timeOnPage / 1000)
      });
      
      if (window.gtag) {
        window.gtag('event', 'privacy_page_view', {
          page_title: document.title,
          sections_viewed: metrics.sectionsViewed,
          reading_progress: Math.round(metrics.readingProgress),
          print_actions: metrics.printActions,
          link_copies: metrics.linkCopies,
          time_on_page: Math.round(timeOnPage / 1000),
          page_language: 'en'
        });
        
        if (metrics.lcp > 0) {
          window.gtag('event', 'web_vitals', {
            metric_name: 'LCP',
            metric_value: Math.round(metrics.lcp),
            metric_unit: 'ms',
            page_type: 'privacy_policy',
            page_language: 'en'
          });
        }
      }
    }, 5000);

    // Make functions globally available
    window.copyToClipboard = copyToClipboard;
  });
</script>

<!-- Print Styles -->
<style is:global>
  @media print {
    .no-print {
      display: none !important;
    }
    
    .fixed {
      position: relative !important;
    }
    
    body {
      font-size: 12pt;
      line-height: 1.4;
    }
    
    h1, h2, h3 {
      page-break-after: avoid;
    }
    
    .prose h2 {
      margin-top: 2em;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.5em;
    }
    
    .bg-gradient-to-r {
      background: #f8f9fa !important;
      border: 1px solid #dee2e6 !important;
    }
  }
  
  /* Enhanced privacy page styles */
  .prose h2 {
    scroll-margin-top: 100px;
  }
  
  .reading-progress {
    transition: width 0.3s ease-out;
  }
  
  /* Navigation hover effects */
  .bg-gray-50 a:hover {
    transform: translateX(4px);
    transition: transform 0.2s ease;
  }
  
  /* Button hover effects */
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
  }
</style>
